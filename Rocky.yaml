vulnerability_check:
  metadata:
    os: "Rocky Linux 9.5"
    script_version: "1.0"
    author: "Generated by ChatGPT"
    date: "2024-12-30"

  checks:
    - id: "U-01"
      category: "계정관리"
      description: "root 계정 원격접속 제한"
      criteria:
        - "telnet 서비스 실행 중지"
        - "/etc/securetty 파일에서 pts 항목 제거"
        - "sshd_config에서 PermitRootLogin 설정"
      commands:
        - "grep -i telnet /etc/services"
        - "grep -i pam_securetty.so /etc/pam.d/login"
        - "grep -i PermitRootLogin /etc/ssh/sshd_config"

    - id: "U-02"
      category: "계정관리"
      description: "패스워드 복잡성 설정"
      criteria:
        - "패스워드 최소 길이 8자리 이상"
        - "영문, 숫자, 특수문자 포함 설정"
      commands:
        - "grep PASS_MIN_LEN /etc/login.defs"
        - "grep -i minlen /etc/security/pwquality.conf"
        - "grep -i pam_pwquality.so /etc/pam.d/system-auth"

    - id: "U-03"
      category: "계정관리"
      description: "계정 잠금 임계값 설정"
      criteria:
        - "계정 잠금 임계값 10회 이하"
      commands:
        - "grep -i deny /etc/pam.d/system-auth"
        - "grep -i pam_faillock.so /etc/pam.d/password-auth"

    - id: "U-04"
      category: "계정관리"
      description: "패스워드 파일 보호"
      criteria:
        - "쉐도우 패스워드 사용"
        - "패스워드를 암호화하여 저장"
      commands:
        - "awk -F: '$2!=\"x\"' /etc/passwd"

    - id: "U-05"
      category: "파일 및 디렉토리 관리"
      description: "root 홈, 패스 디렉터리 권한 및 패스 설정"
      criteria:
        - "PATH 환경 변수에 '.' 또는 '::'가 포함되지 않음"
      commands:
        - "echo $PATH | grep -E '\\.:|::'"
        - "grep 'PATH=' /etc/profile"

    - id: "U-06"
      category: "파일 및 디렉토리 관리"
      description: "소유자가 없는 파일 및 디렉터리 점검"
      criteria:
        - "소유자가 없는 파일 및 디렉터리가 존재하지 않음"
      commands:
        - "find / \\( -nouser -o -nogroup \\)"

    - id: "U-07"
      category: "파일 및 디렉토리 관리"
      description: "/etc/passwd 파일 소유자 및 권한 설정"
      criteria:
        - "소유자가 root"
        - "권한이 644 이하"
      commands:
        - "ls -l /etc/passwd"
        - "stat /etc/passwd"

    - id: "U-08"
      category: "파일 및 디렉토리 관리"
      description: "/etc/shadow 파일 소유자 및 권한 설정"
      criteria:
        - "소유자가 root"
        - "권한이 400 이하"
      commands:
        - "ls -l /etc/shadow"
        - "stat /etc/shadow"

    - id: "U-09"
      category: "파일 및 디렉토리 관리"
      description: "/etc/hosts 파일 소유자 및 권한 설정"
      criteria:
        - "소유자가 root"
        - "권한이 600 이하"
      commands:
        - "ls -l /etc/hosts"
        - "stat /etc/hosts"

    - id: "U-10"
      category: "파일 및 디렉토리 관리"
      description: "/etc/(x)inetd.conf 파일 소유자 및 권한 설정"
      criteria:
        - "소유자가 root"
        - "권한이 600"
      commands:
        - "ls -l /etc/xinetd.conf"
        - "ls -l /etc/inetd.conf"

    - id: "U-11"
      category: "파일 및 디렉토리 관리"
      description: "/etc/syslog.conf 파일 소유자 및 권한 설정"
      criteria:
        - "소유자가 root/bin/sys"
        - "권한이 640 이하"
      commands:
        - "ls -l /etc/rsyslog.conf"
        - "ls -l /etc/syslog.conf"

    - id: "U-12"
      category: "파일 및 디렉토리 관리"
      description: "/etc/services 파일 소유자 및 권한 설정"
      criteria:
        - "소유자가 root"
        - "권한이 644 이하"
      commands:
        - "ls -l /etc/services"

    - id: "U-13"
      category: "파일 및 디렉토리 관리"
      description: "SUID, SGID 설정 파일 점검"
      criteria:
        - "주요 실행 파일에 SUID 및 SGID 설정이 부여되지 않음"
      commands:
        - "find / -perm -4000"
        - "find / -perm -2000"

    - id: "U-14"
      category: "파일 및 디렉토리 관리"
      description: "홈 디렉토리 내 환경 변수 파일 소유자 및 권한 설정"
      criteria:
        - "소유자가 root 또는 해당 계정으로 설정됨"
        - "환경 변수 파일의 쓰기 권한이 root와 소유자에게만 부여됨"
      commands:
        - "ls -l ~"
        - "grep 'PATH=' ~/.bash_profile"

    - id: "U-15"
      category: "파일 및 디렉토리 관리"
      description: "홈 디렉토리 소유자 및 권한 설정"
      criteria:
        - "홈 디렉토리 소유자가 해당 계정과 일치함"
        - "권한이 750 이하로 설정됨"
      commands:
        - "ls -ld /home/*"

    - id: "U-16"
      category: "파일 및 디렉토리 관리"
      description: "/etc/hosts.allow 및 /etc/hosts.deny 파일 설정"
      criteria:
        - "/etc/hosts.allow와 /etc/hosts.deny 파일이 적절히 설정됨"
      commands:
        - "cat /etc/hosts.allow"
        - "cat /etc/hosts.deny"

    - id: "U-17"
      category: "패치 관리"
      description: "패치 관리 및 최신 보안 업데이트 적용 여부 확인"
      criteria:
        - "시스템에 최신 보안 패치가 적용됨"
      commands:
        - "yum check-update"
        - "yum list updates"

    - id: "U-18"
      category: "서비스 관리"
      description: "불필요한 X Windows 시스템 비활성화"
      criteria:
        - "X Windows 시스템이 실행 중이지 않음"
      commands:
        - "systemctl status graphical.target"
        - "systemctl disable graphical.target"

    - id: "U-19"
      category: "서비스 관리"
      description: "불필요한 RPC 서비스 비활성화"
      criteria:
        - "RPC 관련 서비스가 실행 중이지 않음"
      commands:
        - "systemctl status rpcbind"
        - "systemctl disable rpcbind"

    - id: "U-20"
      category: "서비스 관리"
      description: "불필요한 cron 서비스 비활성화"
      criteria:
        - "cron 서비스가 필요하지 않을 경우 비활성화됨"
      commands:
        - "systemctl status crond"
        - "systemctl disable crond"

    - id: "U-21"
      category: "로그 관리"
      description: "로그 파일 소유자 및 권한 설정"
      criteria:
        - "로그 파일 소유자가 root로 설정됨"
        - "권한이 640 이하로 설정됨"
      commands:
        - "find /var/log -type f -exec ls -l {} \\;"

    - id: "U-22"
      category: "로그 관리"
      description: "로그 파일 정기적 백업 여부 확인"
      criteria:
        - "로그 파일이 정기적으로 백업되고 있는지 확인"
      commands:
        - "ls -l /var/log/backup/"
        - "grep cron /etc/crontab"

    - id: "U-23"
      category: "로그 관리"
      description: "로깅 설정 및 정책 확인"
      criteria:
        - "rsyslog 또는 journald가 적절히 설정됨"
      commands:
        - "cat /etc/rsyslog.conf"
        - "journalctl --verify"

    - id: "U-24"
      category: "네트워크 관리"
      description: "SSH 서비스 설정 확인"
      criteria:
        - "SSH 서비스가 안전하게 설정됨"
        - "root 로그인 금지 및 비밀번호 인증 금지 설정"
      commands:
        - "grep PermitRootLogin /etc/ssh/sshd_config"
        - "grep PasswordAuthentication /etc/ssh/sshd_config"

    - id: "U-25"
      category: "네트워크 관리"
      description: "네트워크 포트 스캐닝 및 활성화 포트 점검"
      criteria:
        - "필요하지 않은 포트가 활성화되어 있지 않음"
      commands:
        - "netstat -tuln"
        - "ss -tuln"

    - id: "U-26"
      category: "네트워크 관리"
      description: "방화벽 설정 확인"
      criteria:
        - "방화벽이 활성화되어 있으며, 정책이 적절히 설정됨"
      commands:
        - "firewall-cmd --state"
        - "firewall-cmd --list-all"

    - id: "U-27"
      category: "네트워크 관리"
      description: "IP 포워딩 및 패킷 리다이렉션 비활성화"
      criteria:
        - "IP 포워딩이 비활성화되어 있음"
        - "패킷 리다이렉션이 비활성화되어 있음"
      commands:
        - "sysctl net.ipv4.ip_forward"
        - "sysctl net.ipv4.conf.all.accept_redirects"

    - id: "U-28"
      category: "네트워크 관리"
      description: "TCP Wrappers 설정 확인"
      criteria:
        - "/etc/hosts.allow와 /etc/hosts.deny가 적절히 설정됨"
      commands:
        - "cat /etc/hosts.allow"
        - "cat /etc/hosts.deny"

    - id: "U-29"
      category: "네트워크 관리"
      description: "ARP 스푸핑 방지 설정 확인"
      criteria:
        - "ARP 스푸핑 방지를 위한 정책이 활성화됨"
      commands:
        - "sysctl net.ipv4.conf.all.arp_ignore"
        - "sysctl net.ipv4.conf.all.arp_announce"

    - id: "U-30"
      category: "네트워크 관리"
      description: "DNS 보안 설정 확인"
      criteria:
        - "DNS 서버가 보안 설정을 적용함"
        - "DNS 캐시 포이즈닝 방지가 활성화됨"
      commands:
        - "cat /etc/named.conf"
        - "grep 'dnssec-enable' /etc/named.conf"

    - id: "U-31"
      category: "네트워크 관리"
      description: "NTP 서비스 설정 확인"
      criteria:
        - "NTP 서비스가 정확한 시간 동기화를 제공함"
        - "NTP 서비스에 접근 제어가 설정됨"
      commands:
        - "cat /etc/ntp.conf"
        - "ntpq -p"

    - id: "U-32"
      category: "네트워크 관리"
      description: "SNMP 서비스 설정 확인"
      criteria:
        - "SNMP 서비스가 보안 설정을 적용함"
        - "공개 커뮤니티 문자열이 사용되지 않음"
      commands:
        - "cat /etc/snmp/snmpd.conf"
        - "grep 'community' /etc/snmp/snmpd.conf"

    - id: "U-33"
      category: "네트워크 관리"
      description: "기본 계정 및 비밀번호 변경 여부 확인"
      criteria:
        - "기본 계정의 비밀번호가 변경됨"
        - "불필요한 계정이 비활성화됨"
      commands:
        - "cat /etc/passwd"
        - "grep '^root' /etc/shadow"

    - id: "U-34"
      category: "응용 프로그램 관리"
      description: "웹 서비스 디렉토리 리스팅 금지"
      criteria:
        - "웹 서버의 디렉토리 리스팅이 비활성화됨"
      commands:
        - "grep 'Options' /etc/httpd/conf/httpd.conf"
        - "grep 'Indexes' /etc/httpd/conf/httpd.conf"

    - id: "U-35"
      category: "응용 프로그램 관리"
      description: "웹 서비스 불필요한 파일 제거"
      criteria:
        - "웹 서버에서 불필요한 파일이 제거됨"
      commands:
        - "ls /var/www/html"
        - "find /var/www/html -name '*.bak'"

    - id: "U-36"
      category: "응용 프로그램 관리"
      description: "웹 서비스 상위 디렉토리 접근 금지"
      criteria:
        - "웹 서버의 상위 디렉토리 접근이 차단됨"
      commands:
        - "grep 'AllowOverride None' /etc/httpd/conf/httpd.conf"

    - id: "U-37"
      category: "응용 프로그램 관리"
      description: "웹 서비스 불필요한 HTTP 메소드 금지"
      criteria:
        - "GET, POST 이외의 HTTP 메소드가 제한됨"
      commands:
        - "grep 'LimitExcept' /etc/httpd/conf/httpd.conf"

    - id: "U-38"
      category: "응용 프로그램 관리"
      description: "웹 서비스 최신 보안 패치 적용"
      criteria:
        - "웹 서비스가 최신 보안 패치를 적용함"
      commands:
        - "yum list updates | grep httpd"

    - id: "U-39"
      category: "응용 프로그램 관리"
      description: "FTP 서비스 설정 확인"
      criteria:
        - "FTP 서비스가 보안 설정을 준수함"
        - "익명 사용자의 접근이 금지됨"
      commands:
        - "cat /etc/vsftpd/vsftpd.conf"
        - "grep 'anonymous_enable' /etc/vsftpd/vsftpd.conf"

    - id: "U-40"
      category: "응용 프로그램 관리"
      description: "메일 서비스 설정 확인"
      criteria:
        - "메일 서비스가 보안 설정을 준수함"
        - "스팸 및 릴레이 제한이 설정됨"
      commands:
        - "cat /etc/postfix/main.cf"
        - "grep 'relayhost' /etc/postfix/main.cf"

    - id: "U-41"
      category: "응용 프로그램 관리"
      description: "DNS 서비스 설정 확인"
      criteria:
        - "DNS 서비스가 보안 설정을 준수함"
        - "캐시 포이즈닝 방지 및 접근 제어가 설정됨"
      commands:
        - "cat /etc/named.conf"
        - "grep 'allow-query' /etc/named.conf"

    - id: "U-42"
      category: "응용 프로그램 관리"
      description: "보안 인증서 관리"
      criteria:
        - "SSL/TLS 인증서가 유효하며, 최신 상태임"
      commands:
        - "openssl x509 -in /path/to/cert.pem -noout -dates"
        - "grep 'SSLCertificateFile' /etc/httpd/conf.d/ssl.conf"

    - id: "U-43"
      category: "응용 프로그램 관리"
      description: "SSH 프로토콜 버전 설정 확인"
      criteria:
        - "SSH 프로토콜 버전 2를 사용하도록 설정됨"
      commands:
        - "grep 'Protocol' /etc/ssh/sshd_config"

    - id: "U-44"
      category: "응용 프로그램 관리"
      description: "SNMP 서비스 보안 설정 확인"
      criteria:
        - "SNMP 서비스가 안전하게 구성됨"
        - "공개 커뮤니티 문자열이 사용되지 않음"
      commands:
        - "grep 'community' /etc/snmp/snmpd.conf"
        - "grep 'access' /etc/snmp/snmpd.conf"

    - id: "U-45"
      category: "응용 프로그램 관리"
      description: "Apache 서버 모듈 점검"
      criteria:
        - "필요하지 않은 Apache 모듈이 비활성화됨"
      commands:
        - "apachectl -M"

    - id: "U-46"
      category: "응용 프로그램 관리"
      description: "웹 애플리케이션 방화벽(WAF) 설정 확인"
      criteria:
        - "WAF가 활성화되고, 올바르게 설정됨"
      commands:
        - "grep 'SecRuleEngine' /etc/httpd/conf.d/mod_security.conf"

    - id: "U-47"
      category: "응용 프로그램 관리"
      description: "MySQL/MariaDB 보안 설정 확인"
      criteria:
        - "MySQL/MariaDB가 안전하게 설정됨"
        - "root 계정 비밀번호가 설정됨"
      commands:
        - "mysql -e 'SHOW VARIABLES LIKE \"validate_password%\";'"
        - "grep 'bind-address' /etc/my.cnf"

    - id: "U-48"
      category: "응용 프로그램 관리"
      description: "불필요한 응용 프로그램 제거"
      criteria:
        - "시스템에 불필요한 응용 프로그램이 설치되지 않음"
      commands:
        - "rpm -qa | grep -i 'example-app'"
        - "yum remove example-app"

    - id: "U-49"
      category: "응용 프로그램 관리"
      description: "시스템 보안 감사 도구 설치 및 사용 여부 확인"
      criteria:
        - "보안 감사 도구가 설치되어 있으며, 활성화됨"
      commands:
        - "rpm -qa | grep -i 'audit'"
        - "auditctl -s"

    - id: "U-50"
      category: "파일 및 디렉토리 관리"
      description: "/var 디렉토리의 디스크 사용량 확인"
      criteria:
        - "/var 디렉토리의 디스크 사용량이 적정 수준 이하임"
      commands:
        - "df -h /var"

    - id: "U-51"
      category: "파일 및 디렉토리 관리"
      description: "사용자 홈 디렉토리 디스크 사용량 확인"
      criteria:
        - "사용자 홈 디렉토리의 디스크 사용량이 적정 수준 이하임"
      commands:
        - "du -sh /home/*"

    - id: "U-52"
      category: "파일 및 디렉토리 관리"
      description: "주요 설정 파일의 무결성 확인"
      criteria:
        - "주요 설정 파일의 무결성이 유지됨"
      commands:
        - "rpm -V $(rpm -qf /etc/passwd /etc/shadow /etc/ssh/sshd_config)"

    - id: "U-53"
      category: "파일 및 디렉토리 관리"
      description: "파일 시스템의 마운트 옵션 확인"
      criteria:
        - "파일 시스템에 적절한 마운트 옵션이 설정됨"
      commands:
        - "mount | grep 'noexec'"
        - "grep 'noexec' /etc/fstab"

    - id: "U-54"
      category: "파일 및 디렉토리 관리"
      description: "불필요한 SUID 및 SGID 파일 제거"
      criteria:
        - "불필요한 SUID 및 SGID 파일이 존재하지 않음"
      commands:
        - "find / -perm -4000 -o -perm -2000"

    - id: "U-55"
      category: "파일 및 디렉토리 관리"
      description: "중요 디렉토리 접근 제어 설정"
      criteria:
        - "중요 디렉토리(/etc, /var/log 등)에 접근 제어가 설정됨"
      commands:
        - "ls -ld /etc"
        - "ls -ld /var/log"

    - id: "U-56"
      category: "파일 및 디렉토리 관리"
      description: "/tmp 디렉토리 접근 제어 설정"
      criteria:
        - "/tmp 디렉토리가 noexec, nosuid, nodev 옵션으로 마운트됨"
      commands:
        - "mount | grep /tmp"
        - "grep '/tmp' /etc/fstab"

    - id: "U-57"
      category: "파일 및 디렉토리 관리"
      description: "/var/tmp 디렉토리 접근 제어 설정"
      criteria:
        - "/var/tmp 디렉토리가 noexec, nosuid, nodev 옵션으로 마운트됨"
      commands:
        - "mount | grep /var/tmp"
        - "grep '/var/tmp' /etc/fstab"

    - id: "U-58"
      category: "파일 및 디렉토리 관리"
      description: "/dev/shm 디렉토리 접근 제어 설정"
      criteria:
        - "/dev/shm 디렉토리가 noexec, nosuid, nodev 옵션으로 마운트됨"
      commands:
        - "mount | grep /dev/shm"
        - "grep '/dev/shm' /etc/fstab"

    - id: "U-59"
      category: "파일 및 디렉토리 관리"
      description: "중요 시스템 파일 권한 설정 확인"
      criteria:
        - "중요 시스템 파일(/etc/passwd, /etc/shadow 등)의 권한이 적절히 설정됨"
      commands:
        - "ls -l /etc/passwd"
        - "ls -l /etc/shadow"

    - id: "U-60"
      category: "사용자 및 계정 관리"
      description: "사용하지 않는 계정 잠금"
      criteria:
        - "사용하지 않는 계정이 잠금 처리되었음"
      commands:
        - "passwd -S 사용자명 | grep 'L'"

    - id: "U-61"
      category: "사용자 및 계정 관리"
      description: "관리자 그룹에 불필요한 계정 존재 여부 확인"
      criteria:
        - "관리자 그룹에 불필요한 계정이 존재하지 않음"
      commands:
        - "grep '^wheel' /etc/group"

    - id: "U-62"
      category: "사용자 및 계정 관리"
      description: "사용자 계정에 설정된 만료 기간 확인"
      criteria:
        - "사용자 계정의 만료 기간이 적절히 설정됨"
      commands:
        - "chage -l 사용자명"

    - id: "U-63"
      category: "사용자 및 계정 관리"
      description: "중복 UID 및 GID 확인"
      criteria:
        - "중복된 UID 및 GID가 존재하지 않음"
      commands:
        - "awk -F: '{print $3}' /etc/passwd | sort | uniq -d"
        - "awk -F: '{print $3}' /etc/group | sort | uniq -d"

    - id: "U-64"
      category: "사용자 및 계정 관리"
      description: "빈 패스워드 계정 확인"
      criteria:
        - "빈 패스워드를 사용하는 계정이 존재하지 않음"
      commands:
        - "awk -F: '($2==\"\") {print $1}' /etc/shadow"

    - id: "U-65"
      category: "사용자 및 계정 관리"
      description: "root 계정 보호를 위한 추가 보안 설정"
      criteria:
        - "root 계정의 원격 접속이 금지됨"
        - "root 계정 보호를 위한 보안 설정이 적용됨"
      commands:
        - "grep 'PermitRootLogin' /etc/ssh/sshd_config"

    - id: "U-66"
      category: "로그 및 감사 관리"
      description: "로그 저장 기간 및 용량 확인"
      criteria:
        - "로그 파일이 적절한 기간 동안 보관됨"
        - "로그 파일이 디스크 용량을 초과하지 않음"
      commands:
        - "cat /etc/logrotate.conf"
        - "du -sh /var/log"

    - id: "U-67"
      category: "로그 및 감사 관리"
      description: "감사 로그 설정 확인"
      criteria:
        - "감사 로그가 활성화되고, 적절히 설정됨"
      commands:
        - "grep 'auditd' /etc/audit/auditd.conf"
        - "auditctl -s"

    - id: "U-68"
      category: "로그 및 감사 관리"
      description: "시스템 이벤트 로깅 활성화"
      criteria:
        - "시스템 이벤트가 올바르게 로깅되고 있음"
      commands:
        - "journalctl --verify"

    - id: "U-69"
      category: "네트워크 보안"
      description: "IPTABLES 방화벽 설정 확인"
      criteria:
        - "IPTABLES가 활성화되어 있으며, 정책이 적절히 설정됨"
      commands:
        - "iptables -L -n -v"

    - id: "U-70"
      category: "네트워크 보안"
      description: "불필요한 네트워크 서비스 비활성화"
      criteria:
        - "필요하지 않은 네트워크 서비스가 비활성화됨"
      commands:
        - "systemctl list-unit-files | grep enabled"
        - "netstat -tuln"

    - id: "U-71"
      category: "네트워크 보안"
      description: "TCP SYN Flood 공격 방어 설정 확인"
      criteria:
        - "TCP SYN Flood 공격 방어가 활성화되어 있음"
      commands:
        - "sysctl net.ipv4.tcp_syncookies"
        - "grep 'net.ipv4.tcp_syncookies' /etc/sysctl.conf"

    - id: "U-72"
      category: "네트워크 보안"
      description: "ICMP Redirect 공격 방어 설정 확인"
      criteria:
        - "ICMP Redirect 공격 방어가 활성화되어 있음"
      commands:
        - "sysctl net.ipv4.conf.all.accept_redirects"
        - "sysctl net.ipv4.conf.all.send_redirects"

    - id: "U-73"
      category: "네트워크 보안"
      description: "SSH 비밀번호 인증 비활성화"
      criteria:
        - "SSH 비밀번호 인증이 비활성화됨"
      commands:
        - "grep 'PasswordAuthentication no' /etc/ssh/sshd_config"

    - id: "U-74"
      category: "시스템 보안"
      description: "사용하지 않는 파일 시스템 비활성화"
      criteria:
        - "불필요한 파일 시스템이 비활성화됨"
      commands:
        - "lsmod | grep udf"
        - "lsmod | grep hfs"

    - id: "U-75"
      category: "시스템 보안"
      description: "Kernel 설정 보호 확인"
      criteria:
        - "Kernel 설정이 보호되고 있음"
      commands:
        - "sysctl kernel.randomize_va_space"
        - "grep 'kernel.randomize_va_space' /etc/sysctl.conf"

    - id: "U-76"
      category: "시스템 보안"
      description: "서버 내 보안 로깅 설정 확인"
      criteria:
        - "보안 로깅이 활성화되고 적절히 설정됨"
      commands:
        - "grep 'authpriv' /etc/rsyslog.conf"
        - "journalctl --list-boots"

    - id: "U-77"
      category: "시스템 보안"
      description: "불필요한 서비스 비활성화"
      criteria:
        - "불필요한 서비스가 비활성화됨"
      commands:
        - "chkconfig --list | grep 3:on"
        - "systemctl list-unit-files | grep enabled"

  output:
    result_file: "Results_{{date}}.txt"
    format: "plain_text"

  execution:
    preconditions:
      - "관리자 권한으로 실행"
    commands:
      - "bash vulnerability_check.sh"
